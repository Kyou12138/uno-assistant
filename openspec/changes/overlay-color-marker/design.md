## Context

本变更为 Android 平台增加一个“悬浮标记辅助面板”，在用户玩《一起优诺》时覆盖在游戏上方，用于**手动**标记对手是否“可能没有某种颜色的牌”（排除态置灰，未排除态为彩色）。

关键约束与现状：

- 必须是**覆盖在其他应用上方**的形态（Android `TYPE_APPLICATION_OVERLAY` 悬浮窗）
- 悬浮面板需要可交互（点击颜色切换、增删对手、重置等），因此会占用触控区域并阻挡底层游戏点击
- Android 8+ 对后台服务限制较多，为保证悬浮窗在游戏过程中稳定存在，通常需要**前台服务**（伴随常驻通知）
- 本项目明确不做 OCR/读屏/自动识别，不与游戏数据联动，仅做本地手动记录

## Goals / Non-Goals

**Goals:**

- 提供可在游戏上方显示的悬浮面板，支持透明度调节与位置配置
- 支持动态对手列表，每个对手固定 4 个颜色按钮（红黄蓝绿）
- 支持颜色“排除态”两态切换（灰/彩），支持一键重置
- 支持“解锁可拖动/锁定不拖动”的模式切换，减少误触位移
- 支持本地持久化与恢复（对手列表、颜色状态、位置、透明度、锁定状态）

**Non-Goals:**

- 不做任何自动识别（OCR/读屏/牌面解析/概率推断）
- 不做注入/改包/Hook/脚本，不读取游戏进程或内存
- 不做联网同步、不做账号体系
- 不追求所有厂商 ROM 的“零引导”完美后台保活（MVP 以核心可用为主）

## Decisions

1. **悬浮窗实现方式：前台服务 + WindowManager（推荐）**
   - 方案 A：`ForegroundService` 中通过 `WindowManager.addView()` 添加悬浮视图（`TYPE_APPLICATION_OVERLAY`）
     - 优点：覆盖能力稳定，脱离 Activity 生命周期，游戏中切换前后台影响较小
     - 缺点：需要常驻通知；需要处理 ROM 差异与权限引导
   - 方案 B：Activity/对话框模拟悬浮
     - 缺点：无法稳定覆盖游戏，且多机型受限制，不满足“只接受覆盖”的硬约束
   - 选择：方案 A

2. **UI 技术：Compose UI + ComposeView（嵌入悬浮 View）**
   - 方案 A：传统 View（XML + 自绘）
     - 优点：对 `WindowManager` 场景成熟，事件处理直接
     - 缺点：开发效率相对低，状态管理更繁琐
   - 方案 B：Compose（在悬浮 root view 内放 `ComposeView`）
     - 优点：状态驱动、快速迭代 UI；对“动态对手列表 + 颜色按钮网格”更适合
     - 风险：需要确认 overlay 场景下的生命周期/主题/输入事件处理
   - 选择：优先方案 B；若遇到特定机型/系统兼容问题，降级到方案 A

3. **触控与拖动策略：锁定/解锁两种模式**
   - 解锁模式：允许拖动面板位置；建议将“拖动手势”限制在工具条区域，减少误触颜色按钮
   - 锁定模式：禁止拖动，仅响应按钮点击
   - 原因：悬浮窗占用触控区域，游戏中误拖动会影响体验；通过锁定降低风险

4. **状态与持久化：单一状态仓库 + DataStore（Preferences）**
   - 将对手列表、颜色排除态、面板位置、透明度、锁定状态统一为一个可序列化状态（例如 JSON）
   - 使用 DataStore/Preferences 存储（MVP 阶段足够），启动时恢复
   - 原因：结构简单、恢复快、便于后续扩展（如多套“局”配置）

5. **合规边界：不申请网络权限，不采集屏幕内容**
   - 明确不申请 `INTERNET` 权限（除非后续需求变更）
   - 不读取屏幕像素、不截图、不做无障碍自动化
   - 原因：降低合规/风控风险，保持“手动记录工具”的定位

## Risks / Trade-offs

- [悬浮面板遮挡/阻挡触控] → 面板尽量紧凑、支持透明度、默认靠边布局；后续可增强“折叠为浮标”
- [ROM 权限/后台限制导致悬浮窗消失] → 提供权限引导与常见厂商提示；采用前台服务提高存活
- [前台服务常驻通知影响体验] → 通知内容简洁、可关闭声音/震动；在设置中提供说明（Android 平台约束）
- [Compose 嵌入 overlay 的兼容性] → 先用最小 Compose 视图验证；必要时降级到传统 View

