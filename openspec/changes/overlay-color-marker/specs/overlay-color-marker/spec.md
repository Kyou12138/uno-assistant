## ADDED Requirements

### Requirement: 用户可开启悬浮标记面板并覆盖其他应用
系统 MUST 允许用户开启悬浮标记面板，并在《一起优诺》及其他应用界面上方显示；当未授予“在其他应用上层显示”权限时，系统 MUST 引导用户前往系统设置完成授权，且在授权完成前不得显示悬浮面板。

#### Scenario: 已授权时开启悬浮面板
- **WHEN** 用户在应用内点击“开启悬浮面板”且已授予悬浮窗权限
- **THEN** 系统在当前界面上方显示悬浮标记面板，并保持可见（覆盖在其他应用之上）

#### Scenario: 未授权时引导授权
- **WHEN** 用户在应用内点击“开启悬浮面板”且未授予悬浮窗权限
- **THEN** 系统打开系统悬浮窗授权页面（或提供明确引导入口），且不显示悬浮面板

### Requirement: 用户可调节悬浮面板透明度且立即生效
系统 MUST 提供悬浮面板透明度调节能力，并在用户调整后立即生效；透明度设置 MUST 被持久化并在下次恢复。

#### Scenario: 调整透明度立即生效
- **WHEN** 用户在悬浮面板内将透明度从 A 调整为 B
- **THEN** 悬浮面板整体透明度立即更新为 B

#### Scenario: 透明度可在重启后恢复
- **WHEN** 用户设置透明度为 B 并关闭/重启应用后再次启用悬浮面板
- **THEN** 悬浮面板透明度为 B

### Requirement: 系统支持动态增删对手
系统 MUST 支持动态添加与删除对手；每个对手 MUST 拥有唯一标识，并在面板中以稳定顺序展示；新增对手在未设置昵称时 MUST 使用默认命名（例如“对手 1 / 对手 2 …”）。

#### Scenario: 添加对手
- **WHEN** 用户点击“添加对手”
- **THEN** 系统新增一个对手卡片并显示在列表中，且该对手默认 4 种颜色均为未排除态（彩色）

#### Scenario: 删除对手
- **WHEN** 用户删除某个对手
- **THEN** 系统从列表中移除该对手卡片，且其颜色状态不再参与后续重置/持久化恢复

### Requirement: 每个对手固定提供四种颜色的排除态标记
系统 MUST 为每个对手提供红/黄/蓝/绿四个颜色按钮；颜色按钮 MUST 支持两态切换：
- **排除态（灰色）**：用户认为该对手当前可能没有该颜色的牌
- **未排除态（彩色）**：未排除该颜色（仍可能有），不代表确定有

#### Scenario: 切换为排除态
- **WHEN** 用户点击某对手的“蓝色”按钮且当前为未排除态（彩色）
- **THEN** 系统将该按钮切换为排除态（灰色）

#### Scenario: 从排除态恢复为未排除态
- **WHEN** 用户再次点击同一对手的“蓝色”按钮且当前为排除态（灰色）
- **THEN** 系统将该按钮切换为未排除态（彩色）

### Requirement: 支持解锁拖动定位与锁定防误触
系统 MUST 提供“解锁/锁定”两种模式：
- 解锁模式下，用户 MUST 能拖动悬浮面板到目标位置，位置变更 MUST 被持久化
- 锁定模式下，悬浮面板 MUST 不响应拖动位移（仅响应按钮点击），以减少游戏中误触位移

#### Scenario: 解锁模式可拖动并保存位置
- **WHEN** 用户将面板切换到解锁模式并拖动到新位置
- **THEN** 面板显示在新位置，且下次启用悬浮面板时仍在该位置

#### Scenario: 锁定模式不可拖动
- **WHEN** 用户将面板切换到锁定模式并尝试拖动面板
- **THEN** 面板位置不发生变化

### Requirement: 用户可手动重置所有颜色为未排除态
系统 MUST 提供“重置”操作，用于将所有对手的四种颜色统一恢复为未排除态（彩色）；重置操作 MUST 不删除对手列表。

#### Scenario: 一键重置颜色状态
- **WHEN** 用户点击“重置”
- **THEN** 所有对手的红/黄/蓝/绿均为未排除态（彩色），且对手数量与顺序保持不变

### Requirement: 状态可持久化并在重启后恢复
系统 MUST 持久化并恢复以下状态：对手列表、每个对手的颜色排除态、悬浮面板位置、透明度、锁定状态。

#### Scenario: 重启后恢复完整状态
- **WHEN** 用户在游戏过程中完成若干对手与颜色的标记，并关闭/重启应用后再次启用悬浮面板
- **THEN** 系统恢复相同的对手列表与颜色排除态，以及相同的面板位置、透明度与锁定状态

### Requirement: 悬浮面板启用期间使用前台服务保证稳定性
当悬浮面板启用时，系统 MUST 以 Android 前台服务形式运行，并展示常驻通知；当用户关闭悬浮面板时，系统 MUST 停止前台服务并移除常驻通知。

#### Scenario: 启用悬浮面板时出现常驻通知
- **WHEN** 用户启用悬浮面板
- **THEN** 系统展示常驻通知，且悬浮面板持续可用

#### Scenario: 关闭悬浮面板时移除常驻通知
- **WHEN** 用户关闭悬浮面板
- **THEN** 系统停止前台服务并移除常驻通知

### Requirement: 应用仅做本地手动记录且不使用网络能力
系统 MUST 仅进行本地手动记录，不得进行 OCR/读屏/自动识别；应用 MUST 不声明网络访问能力（例如不申请 `INTERNET` 权限）。

#### Scenario: 清单文件不包含网络权限声明
- **WHEN** 对应用的 `AndroidManifest.xml` 进行静态检查
- **THEN** 不存在 `INTERNET` 权限声明

