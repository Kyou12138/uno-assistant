# 《一起优诺》悬浮标记辅助应用 — 需求说明（Android）

## 1. 背景与目标

用户在手机上玩《一起优诺》时，希望有一个**始终覆盖在游戏上方**的辅助悬浮面板，用于**手动**标记“其他对手当前可能/确定有哪些颜色（红/黄/蓝/绿）”，从而帮助记忆与推理。

> 重要约束：**只接受覆盖在游戏上方的形态**（Android 悬浮窗），并支持**透明度调节**。

## 2. 范围（MVP）

### 2.1 核心能力

1. **悬浮覆盖显示**
   - 悬浮面板可在任意应用（含游戏）上方显示。
   - 支持透明度调节（例如 10%~100%）。

2. **动态对手管理**
   - 对手数量可动态增删（不固定 3 人/4 人）。
   - 每个对手展示一组颜色卡片：**红 / 黄 / 蓝 / 绿**（固定 4 项）。

3. **颜色标记交互（两态切换）**
   - 点击某颜色：该颜色变为**灰色（标记态）**。
   - 再次点击同一颜色：恢复为**原色（未标记态）**。
   - 默认初始状态：4 个颜色均为未标记态（彩色）。
   - 语义说明（本项目定义）：
     - **灰色（标记态）**：表示用户认为“该对手当前**可能没有**该颜色的牌了”（倾向排除）。
     - **彩色（未标记态）**：表示“未排除/仍可能有该颜色”（不代表确定有）。
   - 应用仅做**手动记录**，不做自动推断与纠错。

4. **位置配置与锁定**
   - 配置时可拖动悬浮面板到期望位置。
   - 配置完成后可“锁定位置”，锁定后不再随意拖动（避免误触位移）。

5. **手动重置**
   - 提供“重置”按钮：一键将所有对手的所有颜色恢复为未标记态（彩色）。

### 2.2 明确不做（MVP 不包含）

- 不做自动识别（OCR/读屏/分析牌面/统计推断）。
- 不对游戏做任何注入、改包、Hook、脚本操作。
- 不与游戏数据联动（不识别开局/结算、自动创建对手等）。
- 不提供联网对战数据同步（本地即可）。

## 3. 典型使用流程

1. 用户首次打开应用 → 引导授予“在其他应用上层显示”权限。
2. 开启悬浮面板 → 进入配置模式：
   - 添加对手（可选填昵称）。
   - 拖动到合适位置。
   - 调整透明度。
   - 点击“锁定”完成配置。
3. 游戏中：
   - 根据观察/推理，点击某对手的颜色卡片进行灰/彩切换。
   - 新一局开始时点击“重置”。

## 4. UI / 交互规格（建议）

### 4.1 悬浮面板结构

- **顶部工具条（紧凑）**
  - `+` 添加对手
  - `-` 删除对手（或进入删除模式/从列表选择删除）
  - `重置`
  - `锁定/解锁`
  - `透明度`（滑块或 +/-）

- **对手卡片列表（可横向滚动或纵向堆叠）**
  - 对手标题：`对手 1 / 对手 2 ...`（可点按编辑昵称）
  - 颜色区：4 个颜色按钮（红黄蓝绿）
    - 未标记态：对应颜色填充/高亮
    - 标记态：置灰（保留轮廓与可点击性）

### 4.2 触控与误触控制

- 锁定后：
  - 默认不允许拖动。
  - 仅颜色按钮和工具条按钮响应点击。
- 解锁（配置）模式：
  - 面板可拖动；建议拖动手势限定在工具条区域，减少误触颜色按钮。

### 4.3 透明度

- 透明度调整对整个面板生效（不改变文字可读性时可对背景分层处理）。
- 建议提供几个快捷档位：25% / 50% / 75% / 100%。

## 5. 数据模型与状态

### 5.1 对手模型

- `id`：唯一标识
- `name`：昵称（可空）
- `colors`：4 色状态（布尔两态）
  - `true` = 未排除（彩色，仍可能有该颜色）
  - `false` = 已排除（灰色，可能没有该颜色）

### 5.2 全局配置

- `overlayPosition`：悬浮窗位置（x/y）
- `overlayAlpha`：透明度
- `locked`：锁定状态
- `opponents`：对手列表（顺序即显示顺序）

## 6. 持久化与恢复

- 应用重启后应恢复：
  - 悬浮窗位置、透明度、锁定状态
  - 对手列表及颜色标记状态
- 提供“重置”仅重置颜色标记，不默认清空对手列表（可在设置中提供“清空对手”）。

## 7. 权限与系统能力（Android）

### 7.1 必需权限

- `SYSTEM_ALERT_WINDOW`：在其他应用上层显示（悬浮窗）。

### 7.2 建议能力（用于稳定性）

- 前台服务（Foreground Service）：保证游戏时悬浮窗稳定存在（避免被系统回收）。
- 厂商系统（MIUI/ColorOS/EMUI 等）可能需要额外引导：
  - 自启动/后台运行白名单
  - 电池优化忽略（可选）

> 说明：若系统限制导致悬浮窗被杀死，应用需给出清晰提示与引导路径（不强制）。

## 8. 非功能性需求

- **响应速度**：点击颜色应即时切换，无明显卡顿。
- **可用性**：单手可操作，遮挡尽量小；可折叠（如后续增强）。
- **稳定性**：在游戏前后台切换、锁屏解锁后尽量可恢复显示。
- **安全合规**：仅本地手动记录，不采集游戏内容、不上传个人数据。

## 9. 验收标准（MVP）

1. 授权后可在《一起优诺》上方稳定显示悬浮面板。
2. 透明度可调整且立即生效。
3. 可新增/删除对手，对手数量动态变化。
4. 每个对手的红黄蓝绿可点击切换：彩色 ↔ 灰色。
5. 配置模式可拖动定位；锁定后不易误拖动。
6. “重置”可将所有颜色恢复彩色状态。
7. 退出并重新进入应用后，位置/透明度/对手/标记状态可恢复。

## 10. 后续可选增强（不在 MVP）

- 折叠为小浮标、展开面板（减少遮挡）。
- 对手分组/座位顺序、快速切换布局（横/竖）。
- 撤销/重做（一步回退）。
- 多套“局”配置（不同房间/不同人数快速切换）。
- 导出/导入配置（本地文件）。
