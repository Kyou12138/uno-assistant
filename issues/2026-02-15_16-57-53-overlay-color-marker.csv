"id","priority","phase","area","title","description","acceptance_criteria","test_mcp","review_initial_requirements","review_regression_requirements","dev_state","review_initial_state","review_regression_state","git_state","owner","refs","notes"
"OCM-01-01","P1","1","infra","初始化 Android 工程与清单约束","创建 Android 工程与基础页面入口，配置最低/目标 SDK 与（可选）Compose；在清单中声明悬浮窗相关能力，同时保持“本地手动记录”边界并禁止声明 INTERNET 权限。","WHEN 对 `AndroidManifest.xml` 进行静态检查 → THEN 不存在 `INTERNET` 权限声明; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:90; ref: openspec/changes/overlay-color-marker/tasks.md:41; ref: openspec/changes/overlay-color-marker/tasks.md:5; SHALL/MUST: 应用 MUST 不声明网络访问能力（例如不申请 `INTERNET` 权限）; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:87; ref: openspec/changes/overlay-color-marker/design.md:59; 提供基础页面：可开启/关闭悬浮面板并进入权限引导; ref: openspec/changes/overlay-color-marker/tasks.md:6; ref: requirement.md:46","CONTRACT","确认 minSdk/targetSdk 满足 overlay/前台服务要求；确认清单与依赖最小化且不引入网络权限；若启用 Compose，确认 Compose 配置与主题在 overlay 场景可用。ref: openspec/changes/overlay-color-marker/design.md:39; ref: openspec/changes/overlay-color-marker/design.md:59","任何清单/构建变更后复查：悬浮窗权限流程可达、开启/关闭悬浮不受影响、无残留通知/服务。ref: requirement.md:132; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:76","已完成","已完成","已完成","已提交","","openspec/changes/overlay-color-marker/tasks.md:1; openspec/changes/overlay-color-marker/tasks.md:5; openspec/changes/overlay-color-marker/tasks.md:6; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:87; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:90; requirement.md:46; app/src/main/AndroidManifest.xml:4; app/src/main/AndroidManifest.xml:5; app/build.gradle.kts:13; app/build.gradle.kts:14; app/src/main/java/com/unoassistant/overlay/MainActivity.kt:50; app/src/main/java/com/unoassistant/overlay/MainActivity.kt:87; app/src/main/java/com/unoassistant/overlay/MainActivity.kt:96; app/src/main/res/values/themes.xml:2","ID 前缀采用 OCM（Overlay Color Marker），因为 tasks.md 未包含 WT2-0X 形式的任务组编号；后续会议如需可统一改名。 | picked_reason:基础工程与Manifest约束是后续悬浮窗/前台服务等所有任务的前置 | done_at:2026-02-15T17:05:53+08:00 | evidence:Manifest 含 SYSTEM_ALERT_WINDOW/FOREGROUND_SERVICE 且未声明 INTERNET；minSdk=26/targetSdk=34；基础页含开启/关闭与授权引导入口 | validation_limited:当前环境缺少 Android SDK/Gradle Wrapper，无法执行真机或模拟器回归 | manual_test:安装后依次执行 授权引导->返回主页->点击开启/关闭入口，确认权限状态文案随返回刷新 | risk:medium 仅完成静态与代码级验证，未完成设备级前台服务/悬浮回归 | blocked:git commit failed 未配置 user.name/user.email | unblocked:git identity configured locally (uno-assistant@local.invalid) | followup_fix:修复 themes.xml 主题父类与透明色引用，解除 :app:processDebugResources 资源链接失败"
"OCM-02-01","P1","2","infra","悬浮窗权限检测与授权引导","实现 canDrawOverlays 权限检测、状态展示与跳转授权页；确保“未授权不可开启悬浮面板”，并处理从设置返回后的状态刷新。","WHEN 用户点击“开启悬浮面板”且已授予悬浮窗权限 → THEN 显示悬浮标记面板并覆盖其他应用; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:6; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:3; WHEN 用户点击“开启悬浮面板”且未授予悬浮窗权限 → THEN 打开系统悬浮窗授权页且不显示面板; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:10; ref: openspec/changes/overlay-color-marker/tasks.md:11; 权限入口与说明包含 requirement.md 约束（只接受覆盖形态）; ref: requirement.md:7; ref: requirement.md:112","MANUAL","校验三条路径：已授权直接开启；未授权引导到设置且不显示；从设置返回后状态刷新正确且不循环跳转。ref: openspec/changes/overlay-color-marker/tasks.md:10; ref: openspec/changes/overlay-color-marker/tasks.md:12","不同 ROM/Android 版本回归验证授权与返回流程；避免“已授权仍提示未授权”的缓存问题。ref: openspec/changes/overlay-color-marker/design.md:66","已完成","已完成","已完成","已提交","","openspec/changes/overlay-color-marker/tasks.md:8; openspec/changes/overlay-color-marker/tasks.md:10; openspec/changes/overlay-color-marker/tasks.md:11; openspec/changes/overlay-color-marker/tasks.md:12; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:3; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:6; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:10; requirement.md:112; app/src/main/java/com/unoassistant/overlay/MainActivity.kt:50; app/src/main/java/com/unoassistant/overlay/MainActivity.kt:94; app/src/main/java/com/unoassistant/overlay/MainActivity.kt:98; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:27; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:37; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:53","权限文案需强调本应用仅手动记录、不做读屏/OCR，降低误解与合规风险。ref: requirement.md:37 | picked_reason:在已初始化工程基础上优先完成权限检测与授权返回刷新，可直接解锁后续服务启停链路 | done_at:2026-02-15T17:13:02+08:00 | evidence:未授权点击开启会跳转授权页且不显示；已授权会通过 WindowManager(TYPE_APPLICATION_OVERLAY) 显示可点击面板并可关闭；返回应用时权限状态与面板状态会在 ON_RESUME 刷新 | validation_limited:当前环境无法安装/运行 Android（缺少 JDK/Android SDK），仅完成代码级与静态检查 | manual_test:1) 未授权点“开启悬浮面板”应跳转设置且不出现面板 2) 授权后返回应显示“已授权” 3) 再点开启应出现悬浮面板覆盖其他应用 4) 点面板内关闭应消失 5) 返回应用“面板状态”刷新正确 | risk:medium 依赖 ROM 行为与系统权限页返回路径，需真机覆盖验证"
"OCM-03-01","P1","3","infra","前台服务与常驻通知（启用/关闭）","实现前台服务骨架、通知渠道与常驻通知；启用悬浮面板时启动前台服务，关闭时停止服务并移除通知，防止残留。","WHEN 用户启用悬浮面板 → THEN 系统展示常驻通知且悬浮面板持续可用; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:79; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:76; ref: openspec/changes/overlay-color-marker/tasks.md:16; WHEN 用户关闭悬浮面板 → THEN 系统停止前台服务并移除常驻通知; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:83; ref: openspec/changes/overlay-color-marker/tasks.md:18","MANUAL","确认 Android 8+ 通知渠道创建与前台服务启动时机正确；关闭路径一定能执行（无论当前在前台/后台）。ref: openspec/changes/overlay-color-marker/design.md:9; ref: openspec/changes/overlay-color-marker/tasks.md:16","重复开启/关闭多次：不出现多个通知、不出现“服务已停止但通知仍在”的残留；异常退出后再次开启可恢复。ref: openspec/changes/overlay-color-marker/design.md:67; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:83","已完成","已完成","已完成","已提交","","openspec/changes/overlay-color-marker/tasks.md:14; openspec/changes/overlay-color-marker/tasks.md:16; openspec/changes/overlay-color-marker/tasks.md:18; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:76; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:79; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:83; openspec/changes/overlay-color-marker/design.md:9; app/src/main/java/com/unoassistant/overlay/OverlayForegroundService.kt:19; app/src/main/java/com/unoassistant/overlay/OverlayForegroundService.kt:41; app/src/main/java/com/unoassistant/overlay/OverlayForegroundService.kt:61; app/src/main/java/com/unoassistant/overlay/OverlayServiceController.kt:10; app/src/main/java/com/unoassistant/overlay/MainActivity.kt:94; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:86; app/src/main/AndroidManifest.xml:21; app/src/main/AndroidManifest.xml:6; app/src/main/AndroidManifest.xml:25; app/src/main/AndroidManifest.xml:28; app/src/main/java/com/unoassistant/overlay/OverlayForegroundService.kt:55; app/src/main/java/com/unoassistant/overlay/OverlayForegroundService.kt:59","前台服务是 overlay 稳定性的关键设计决策，避免依赖 Activity 生命周期。ref: openspec/changes/overlay-color-marker/design.md:31 | picked_reason:前台服务与通知是悬浮窗稳定性的核心前置，先闭环可避免后续功能在后台被系统回收 | done_at:2026-02-15T17:14:51+08:00 | evidence:开启悬浮时调用 startForegroundService 并 startForeground(1001) 展示常驻通知；关闭路径通过 ACTION_STOP stopForeground(remove)+stopSelf 并兜底移除 Overlay；Overlay 内关闭也会 stop 服务避免通知残留 | validation_limited:当前环境无法运行 Android 设备/模拟器（缺少 JDK/Android SDK），仅完成代码级与静态检查 | manual_test:1) 已授权点开启应出现常驻通知 2) 连续点开启多次通知仍为单个 3) 点应用内关闭或通知“关闭”动作通知应移除且悬浮消失 4) 退到后台后也可通过通知关闭 | risk:medium 通知渠道与前台服务在不同 ROM 行为差异需真机验证 | followup_fix:修复 Android 14+ MissingForegroundServiceTypeException（补充 specialUse FGS 类型与 ServiceCompat.startForeground 类型参数） | e2e_2026-02-15:emulator-5554 验证 deny 时服务不启动；allow 时 isForeground=true,startForegroundCount=1；点击关闭后服务为空"
"OCM-03-02","P1","3","infra","WindowManager 悬浮窗容器与生命周期","在前台服务中使用 WindowManager 添加/移除悬浮根视图（TYPE_APPLICATION_OVERLAY），设置基础 flags（可见但不抢焦点），确保游戏内可见且可交互。","在已授权时创建并添加 overlay（`TYPE_APPLICATION_OVERLAY`），在《一起优诺》界面上方可见且可点击; ref: openspec/changes/overlay-color-marker/tasks.md:17; ref: openspec/changes/overlay-color-marker/design.md:7; ref: requirement.md:7; 关闭悬浮面板时必须移除 overlay 视图并释放资源，且常驻通知/服务同步停止; ref: openspec/changes/overlay-color-marker/tasks.md:18; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:83; overlay 不抢占系统焦点（不导致底层应用被锁死/无法返回），手动验证通过; ref: openspec/changes/overlay-color-marker/tasks.md:17; ref: openspec/changes/overlay-color-marker/design.md:8","MANUAL","严格控制 addView/removeView 只执行一次并有幂等保护；overlay flags 选择需符合“不抢焦点”目标；异常时兜底移除避免窗口泄漏。ref: openspec/changes/overlay-color-marker/design.md:31; ref: openspec/changes/overlay-color-marker/tasks.md:17","回归验证：切后台/锁屏解锁后 overlay 仍可正常关闭；ROM 限制导致 overlay 消失时提示不崩溃。ref: openspec/changes/overlay-color-marker/design.md:66","已完成","已完成","已完成","已提交","","openspec/changes/overlay-color-marker/tasks.md:17; openspec/changes/overlay-color-marker/tasks.md:18; openspec/changes/overlay-color-marker/design.md:7; openspec/changes/overlay-color-marker/design.md:8; requirement.md:7; app/src/main/java/com/unoassistant/overlay/OverlayForegroundService.kt:36; app/src/main/java/com/unoassistant/overlay/OverlayForegroundService.kt:39; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:37; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:38; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:53; app/src/main/java/com/unoassistant/overlay/MainActivity.kt:103; app/src/main/java/com/unoassistant/overlay/MainActivity.kt:114","悬浮面板会占用触控区域并遮挡底层点击，需在 UI 设计中保持紧凑并支持透明度。ref: openspec/changes/overlay-color-marker/design.md:8; ref: requirement.md:67 | picked_reason:将 Overlay 添加/移除收敛到前台服务，确保脱离 Activity 生命周期并符合后续稳定覆盖设计 | done_at:2026-02-15T17:16:20+08:00 | evidence:Overlay add/remove 迁移到前台服务 handleStart/ACTION_STOP；使用 TYPE_APPLICATION_OVERLAY + FLAG_NOT_FOCUSABLE，关闭时 removeView 并 stopForeground+stopSelf；未授权启动会回滚停止服务避免假启用 | validation_limited:当前环境无法真机/模拟器验证 overlay 跨应用覆盖与返回键行为（缺少 JDK/Android SDK） | manual_test:1) 已授权开启后切到其它应用应见悬浮面板且可点击 2) 返回键/系统手势可正常使用不被焦点锁死 3) 关闭后面板与通知都消失 4) 锁屏再解锁后仍可关闭且不崩溃 | risk:medium ROM 对 overlay 行为存在差异，需机型回归"
"OCM-04-01","P1","4","frontend","状态模型与 DataStore 持久化恢复","定义对手列表、颜色排除态、位置、透明度、锁定等统一状态模型；接入 DataStore/Preferences 保存与恢复，确保进程重启后状态一致。","WHEN 用户在游戏过程中完成标记/增删对手/拖动位置/调整透明度并重启后再次启用 → THEN 恢复完整状态; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:72; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:69; ref: openspec/changes/overlay-color-marker/tasks.md:24; ref: requirement.md:103; WHEN 用户设置透明度为 B 并关闭/重启后再次启用 → THEN 透明度为 B; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:21; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:14; 状态字段覆盖：对手列表、颜色排除态、位置、透明度、锁定状态; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:69; ref: requirement.md:90","MANUAL","状态模型需可扩展（新增字段不破坏旧数据）；写入频率需节制避免卡顿；默认值策略明确（坏数据自动回退）。ref: openspec/changes/overlay-color-marker/design.md:53","回归验证“被系统杀进程/重启”后的恢复一致性；确保版本升级后旧存储仍可读取或安全重置。ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:72","已完成","已完成","已完成","已提交","","openspec/changes/overlay-color-marker/tasks.md:20; openspec/changes/overlay-color-marker/tasks.md:22; openspec/changes/overlay-color-marker/tasks.md:23; openspec/changes/overlay-color-marker/tasks.md:24; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:69; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:72; requirement.md:103; app/src/main/java/com/unoassistant/overlay/model/OverlayModels.kt:30; app/src/main/java/com/unoassistant/overlay/persist/OverlayStateStore.kt:20; app/src/main/java/com/unoassistant/overlay/persist/OverlayStateJson.kt:14; app/src/main/java/com/unoassistant/overlay/persist/OverlayStateRepository.kt:20; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:34; app/build.gradle.kts:55","持久化/恢复是用户手动重置可接受的前提：默认保存局内推理状态，手动重置用于开启新一局。ref: requirement.md:38 | picked_reason:先完成统一状态与持久化可避免后续 UI 功能重复返工，并直接支撑重启恢复验收 | done_at:2026-02-15T17:20:07+08:00 | evidence:新增 OverlayState(位置/透明度/锁定/对手/颜色) 模型；DataStore(Preferences) 单 key 存储并支持坏数据回退默认；Overlay 显示时读取并应用持久化的 x/y/alpha | validation_limited:当前环境无法执行进程重启/真机恢复验证（缺少 JDK/Android SDK），仅完成代码级与静态检查 | manual_test:1) 开启悬浮后（后续 issue 完成拖动/透明度/对手标记）执行强杀进程或重启设备 2) 再开启应恢复位置/透明度/锁定/对手/颜色状态 | risk:medium 当前采用自定义轻量序列化与启动时 runBlocking 读取，需后续在高频写入时做节流与性能验证"
"OCM-05-01","P2","5","frontend","对手管理 UI（增删/默认命名/列表渲染）","在悬浮面板中实现工具条与对手列表渲染：支持动态增删对手、默认命名与稳定顺序展示，新增对手默认四色为未排除态。","WHEN 用户点击“添加对手” → THEN 新增对手卡片并显示在列表中，且默认 4 色均为未排除态（彩色）; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:28; ref: openspec/changes/overlay-color-marker/tasks.md:28; ref: requirement.md:17; WHEN 用户删除某对手 → THEN 从列表移除该对手且后续重置/恢复不包含该对手; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:32; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:25; 默认命名遵循“对手 1/2/…”且人数可动态变化; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:25; ref: requirement.md:17","MANUAL","确认增删对手操作不会误影响其他对手状态；默认命名与排序稳定；删除后持久化同步更新。ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:25; ref: openspec/changes/overlay-color-marker/tasks.md:28","回归验证：对手数量增多时列表可滚动且不影响点击准确性；透明度变化不降低可用性。ref: requirement.md:55; ref: requirement.md:61","已完成","已完成","已完成","已提交","","openspec/changes/overlay-color-marker/tasks.md:28; openspec/changes/overlay-color-marker/tasks.md:29; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:25; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:28; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:32; requirement.md:17; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:88; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:124; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:134; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:153; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:172; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:218; app/src/main/java/com/unoassistant/overlay/model/OverlayModels.kt:44","UI 必须保持紧凑与可单手操作，避免遮挡游戏关键区域；必要时后续再做折叠浮标增强（非 MVP）。ref: openspec/changes/overlay-color-marker/design.md:65 | picked_reason:先实现对手列表增删与渲染，可为下一条颜色切换/重置提供直接可操作的数据载体 | done_at:2026-02-15T17:23:31+08:00 | evidence:Overlay 内已实现“添加对手”与按行删除；新增默认命名为对手 N（max+1 策略）且默认四色为未排除态（彩色）；列表渲染支持动态数量并持久化同步 | validation_limited:当前环境无法运行 Android 设备验证滚动与触控准确性（缺少 JDK/Android SDK），仅完成代码级与静态检查 | manual_test:1) 连续添加对手应显示 对手1/2/3... 2) 删除中间任一对手后列表即时更新 3) 关闭再开启悬浮后对手列表与顺序保持一致 | risk:medium 当前为 MVP 视图实现，列表项增多时需真机验证可点击区域与遮挡"
"OCM-05-02","P2","5","frontend","颜色排除态切换与一键重置","实现每个对手的红黄蓝绿四按钮两态切换：彩色=未排除/仍可能有，灰色=排除态（可能没有该颜色）；实现“重置”仅重置颜色不删除对手；并修复绿色按钮在白底场景下可见性不足问题（颜色与文字对比度需可读）。","WHEN 用户点击某对手的“蓝色”按钮且当前为未排除态（彩色） → THEN 切换为排除态（灰色）; WHEN 用户再次点击同一按钮且当前为排除态（灰色） → THEN 恢复为未排除态（彩色）; 灰色语义=“可能没有该颜色”，彩色语义=“未排除/仍可能有（不代表确定有）”; WHEN 用户点击“重置” → THEN 所有对手四色恢复未排除态且对手列表不变; WHEN 在白底悬浮面板中渲染绿色按钮（未排除态） → THEN 绿色按钮与文字在常见亮度下清晰可辨（不可与背景混淆）","MANUAL","确认四色按钮在白底与半透明背景下均有足够可见性；绿色按钮文本/底色对比不低于其它颜色；重置只重置颜色不清空对手。","回归验证：重启后颜色状态保持一致；重置后所有状态一致且可继续标记；不同系统主题（浅色/深色）下绿色按钮仍可读。","已完成","已完成","已完成","已提交","","openspec/changes/overlay-color-marker/tasks.md:30; openspec/changes/overlay-color-marker/tasks.md:31; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:36; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:41; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:45; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:62; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:65; requirement.md:26; requirement.md:34; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:92; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:148; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:217; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:231; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:238; app/src/main/java/com/unoassistant/overlay/model/OverlayModels.kt:21; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:295; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:299; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:301; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:303; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:223; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:226; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:301; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:310; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:318","颜色标记仅为手动推理记录，不做自动纠错；避免在 UI 中暗示“确定有/确定没有”。ref: requirement.md:27 | picked_reason:在对手列表已可增删后接入颜色两态与重置，可直接形成核心标记闭环 | done_at:2026-02-15T17:24:44+08:00 | evidence:每个对手 R/Y/B/G 按钮已实现两态切换（彩色=未排除，灰色=排除态）并持久化；新增“重置颜色”会把所有对手四色恢复未排除且不删除对手 | validation_limited:当前环境无法在 Android 设备执行交互回归（缺少 JDK/Android SDK），仅完成代码级与静态检查 | manual_test:1) 点击同一颜色按钮应在彩色<->灰色间切换 2) 连点不同对手互不串扰 3) 点击重置后仅颜色恢复，对手数量与顺序不变 4) 重启后颜色状态保持 | risk:medium 当前按钮为系统原生样式，透明度较低场景下对比度需真机核验 | picked_reason:用户反馈绿色按钮不可见，需优先修复颜色可读性缺陷 | done_at:2026-02-15T18:52:16+08:00 | evidence:绿色按钮底色调整为深绿(0xFF1B5E20)并补充文字对比色；排除态灰色同步加深，白底与半透明背景下可读性提升 | validation_limited:已完成编译验证(:app:assembleDebug)，颜色可见性仍需按实际屏幕亮度与主题进行真机目测确认 | manual_test:1) 在白底面板观察绿色按钮需明显区别于背景 2) 绿色按钮在彩色/灰色切换时文字均清晰 3) 不同亮度与深浅主题下保持可读 | risk:low 仅视觉对比调整，不改变状态逻辑 | self_verify_2026-02-15:模拟器截图显示对手行布局过宽，仅能看到 R/Y/B，G 被挤出屏幕（绿色不可见的根因），需调整布局保证四按钮可见 | done_at:2026-02-15T18:58:01+08:00 | evidence:self_verify 截图对比：修复前(tmp_e2e_1.png) 因横向溢出仅显示 R/Y/B；修复后(tmp_e2e_2.png) 采用 2x2 配置并显示完整 R/Y/B/G，绿色清晰可见 | validation_limited:已在模拟器完成可见性截图验证与安装回归，但不同真机 DPI/字体缩放仍建议补测 | manual_test:1) 开启悬浮后观察每个对手均显示 R/Y/B/G 四按钮 2) 绿色 G 在白底下清晰可见 3) 缩放/旋转后仍不丢列 | risk:low 本次为布局与视觉对比修复，不改变状态机与持久化逻辑"
"OCM-06-01","P2","6","frontend","拖动定位（解锁）与锁定防误触","实现每个对手显示信息可独立拖动定位并持久化（而非仅整面板拖动）；锁定模式下禁止对手卡片位移，仅响应点击，降低游戏中误触。","WHEN 用户将面板切换到解锁模式并拖动某个对手卡片到新位置 → THEN 仅该对手卡片位置更新且关闭/重启后仍在该位置; WHEN 用户将面板切换到锁定模式并尝试拖动任一对手卡片 → THEN 该卡片位置不发生变化; WHEN 拖动某对手卡片 → THEN 不影响其他对手卡片位置与颜色状态","MANUAL","确认拖动手势仅作用于被拖动的对手卡片；位置更新需按对手维度持久化；锁定状态下卡片拖动严格禁用。","回归验证：新增/删除对手后其余卡片位置保持；重启后每个对手卡片位置恢复；锁定状态下无误位移。","已完成","已完成","已完成","已提交","","openspec/changes/overlay-color-marker/tasks.md:33; openspec/changes/overlay-color-marker/tasks.md:35; openspec/changes/overlay-color-marker/tasks.md:36; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:49; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:54; openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:58; requirement.md:30; requirement.md:75; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:93; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:117; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:166; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:185; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:207; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:219; app/src/main/java/com/unoassistant/overlay/model/OverlayModels.kt:19; app/src/main/java/com/unoassistant/overlay/persist/OverlayStateJson.kt:26; app/src/main/java/com/unoassistant/overlay/persist/OverlayStateJson.kt:87; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:113; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:221; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:227; app/src/main/java/com/unoassistant/overlay/OverlayPanelManager.kt:264","如后续发现拖动/点击冲突严重，可考虑增加“长按拖动”或“单独拖动手柄”（增强项）。 | picked_reason:在核心标记交互已可用后补齐拖动与锁定，可显著降低游戏中误触位移风险 | done_at:2026-02-15T17:26:34+08:00 | evidence:新增锁定/解锁按钮并持久化 locked；拖动仅挂载在标题 drag_handle，且仅在解锁模式生效；拖动结束会持久化 overlayX/overlayY 供下次恢复 | validation_limited:当前环境无法真机验证触摸事件与跨应用拖动行为（缺少 JDK/Android SDK） | manual_test:1) 默认锁定时拖动标题无位移 2) 切到已解锁后拖动标题可移动 3) 重新锁定后再次拖动无效 4) 关闭再开启应恢复上次位置与锁定状态 | risk:medium 不同 ROM 的触摸分发可能影响拖动手感，需机型回归 | picked_reason:用户希望按对手粒度自定义布局，需从整面板拖动升级为对手级拖动并保留锁定机制 | done_at:2026-02-15T18:50:47+08:00 | evidence:对手模型新增 offsetX/offsetY 并持久化；解锁时可拖动“对手名”仅移动该对手卡片，锁定时拖动不生效；拖动结果按对手维度保存并在重绘时恢复 | validation_limited:已完成编译验证(:app:assembleDebug)，但未完成全量手势自动化回放，需真机补充拖动手感与边界回归 | manual_test:1) 解锁后拖动某个对手名，仅该对手位置变化 2) 锁定后再次拖动无效 3) 关闭再开启后每个对手保持各自位置 4) 删除某对手不影响其他对手位置 | risk:medium 多对手重叠场景的可触达性需按机型补测"
"OCM-07-01","P2","7","both","验证清单与机型提示文案落盘","落盘可执行的验证步骤：静态检查无 INTERNET 权限、端到端手测路径；补充常见机型（ROM）权限/后台限制提示文案与引导入口。","静态检查：`AndroidManifest.xml` 不包含 `INTERNET` 权限声明; ref: openspec/changes/overlay-color-marker/tasks.md:41; ref: openspec/changes/overlay-color-marker/specs/overlay-color-marker/spec.md:90; 端到端手测覆盖：授权→开启悬浮→标记/增删对手→重启恢复→关闭悬浮; ref: openspec/changes/overlay-color-marker/tasks.md:42; ref: requirement.md:46; ref: requirement.md:132; 提供 ROM 限制提示与引导（如后台限制导致悬浮消失），文案与入口可达; ref: openspec/changes/overlay-color-marker/tasks.md:43; ref: openspec/changes/overlay-color-marker/design.md:66","MANUAL","验收步骤必须可复现且可由非开发人员执行；ROM 引导文案避免夸大效果，明确“可能需要额外设置”。ref: openspec/changes/overlay-color-marker/design.md:66; ref: requirement.md:123","每次改动 overlay/服务/持久化相关逻辑后复跑关键路径（授权/开启/关闭/重启恢复）；记录异常机型与复现步骤。ref: requirement.md:132","已完成","已完成","已完成","已提交","","openspec/changes/overlay-color-marker/tasks.md:39; openspec/changes/overlay-color-marker/tasks.md:41; openspec/changes/overlay-color-marker/tasks.md:42; openspec/changes/overlay-color-marker/tasks.md:43; openspec/changes/overlay-color-marker/design.md:66; requirement.md:132; docs/overlay-validation.md:1; docs/overlay-validation.md:13; docs/overlay-validation.md:49; app/src/main/AndroidManifest.xml:4; app/src/main/AndroidManifest.xml:5","此条为“会议落盘的验收合同”：若后续引入自动化测试（仪器测试/截图测试），可在此条补充命令与门槛。 | picked_reason:收尾阶段先沉淀验证清单与ROM提示文案，便于后续真机验收与交付 | done_at:2026-02-15T17:27:58+08:00 | evidence:新增 docs/overlay-validation.md，落盘静态检查、端到端手测步骤与 ROM 限制提示文案；并复核 Manifest 不含 INTERNET 且含 SYSTEM_ALERT_WINDOW/FOREGROUND_SERVICE | validation_limited:文档与静态检查已完成；设备级回归需在真实机型执行 | manual_test:按 docs/overlay-validation.md 第2节逐项执行并记录机型/系统版本/异常现象 | risk:low 本条以文档与流程收敛为主，风险主要来自机型差异 | e2e_record_2026-02-15:已执行自动化主链路（installDebug+UI点击+services/window/logcat采证）；覆盖授权门禁/前台服务启停，未覆盖对手增删与拖动的系统层可见性校验（uiautomator 对悬浮层可见性受限）"
